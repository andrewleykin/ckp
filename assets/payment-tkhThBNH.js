import{d as _,g as s,c as h,b as p,w as i,u as o,a as U,h as c,i as f,o as d,f as u,j as k}from"./index-YL4AAcl0.js";import{P as N,A as V}from"./index-pxBI3MdA.js";import{P as b}from"./payment-block-ByWjG6UD.js";import{U as g,a as B,_ as w}from"./ui-input-phone-oXEF9li1.js";import"./ui-icon-BRi8thUF.js";import{U as x,_ as P}from"./ui-typography-Df9E3_dG.js";const I={class:"group mb-32"},C=_({__name:"payment",setup(E){const{notify:l}=k(),e=s({phoneNumber:"",inn:""}),r=s(!1),y=s(!1),n=s(),v=async()=>{if(!r.value){if(e.value.phoneNumber.length!==N||!e.value.inn){l({title:"Некорректные данные",type:"warn"});return}r.value=!0;try{const{data:t}=await f.shipmentController.findBy(e.value);if(!t.id){l({title:"Некорректные данные оплаты",type:"warn"});return}const{data:a}=await f.tinkoffPayment.payTinkoff({shipmentIds:[t.id]});if(!a.paymentURL){l({title:"Некорректная ссылка оплаты. Обратитесь в поддержку",type:"warn"});return}n.value=a.paymentURL,y.value=!0}catch(t){t instanceof V&&l({title:"Произошла ошибка",text:t.message,type:"error"})}finally{r.value=!1}}};return(t,a)=>(d(),h("main",null,[p(o(x),{variant:"HeadlineH3",class:"mb-24"},{default:i(()=>[u(" Оплата SIM карт ")]),_:1}),U("div",I,[p(o(g),{modelValue:e.value.phoneNumber,"onUpdate:modelValue":a[0]||(a[0]=m=>e.value.phoneNumber=m),readonly:!!n.value},{default:i(()=>[u(" Номер телефона ")]),_:1},8,["modelValue","readonly"]),p(o(B),{modelValue:e.value.inn,"onUpdate:modelValue":a[1]||(a[1]=m=>e.value.inn=m),readonly:!!n.value},{default:i(()=>[u(" ИНН клиента ")]),_:1},8,["modelValue","readonly"])]),n.value?(d(),c(o(b),{key:0,"payment-url":n.value},null,8,["payment-url"])):(d(),c(o(w),{key:1,"is-loading":r.value,onClick:v},{default:i(()=>[u(" Подтвердить ")]),_:1},8,["is-loading"]))]))}}),j=P(C,[["__scopeId","data-v-ca0bcc83"]]);export{j as default};
